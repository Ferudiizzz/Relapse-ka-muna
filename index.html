<!DOCTYPE html>
<html>

<head>
    <title>Sky Parkour</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: skyblue;
        }

        canvas {
            display: block;
            background: skyblue;
        }

        #failVideo {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            display: none;
            z-index: 999;
        }

        #controls {
            position: fixed;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            z-index: 1000;
        }

        #controls button {
            font-size: 1.5em;
            padding: 10px 20px;
            border: none;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            user-select: none;
        }
    </style>
</head>

<body>

    <video id="failVideo" autoplay playsinline>
        <source src="will.mp4" type="video/mp4">
    </video>
    <audio id="jumpSound" src="jump.mp3" preload="auto"></audio>

    <canvas id="gameCanvas"></canvas>

    <div id="controls">
        <div>
            <button id="leftButton">◀</button>
            <button id="rightButton">▶</button>
        </div>
        <button id="jumpButton">Jump</button>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const jumpSound = document.getElementById('jumpSound');

        const leftButton = document.getElementById('leftButton');
        const rightButton = document.getElementById('rightButton');
        const jumpButton = document.getElementById('jumpButton');
        // NEW: Get the controls element
        const controls = document.getElementById('controls');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let player = {
            x: 100,
            y: 100,
            w: 40,
            h: 40,
            vy: 0,
            grounded: false
        };
        const gravity = 0.5;
        const jumpPower = -10;

        const platforms = [{
            x: 50,
            y: 400,
            w: 100,
            h: 20
        }, // spawn
        {
            x: 250,
            y: 350,
            w: 100,
            h: 20
        }, {
            x: 450,
            y: 300,
            w: 100,
            h: 20
        }, {
            x: 650,
            y: 250,
            w: 100,
            h: 20
        }, {
            x: 850,
            y: 200,
            w: 100,
            h: 20,
            win: true
        } // win pad
        ];

        let keys = {};

        window.addEventListener("keydown", e => keys[e.key] = true);
        window.addEventListener("keyup", e => keys[e.key] = false);

        leftButton.addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys['ArrowLeft'] = true;
        });
        leftButton.addEventListener('touchend', () => keys['ArrowLeft'] = false);
        leftButton.addEventListener('mousedown', () => keys['ArrowLeft'] = true);
        leftButton.addEventListener('mouseup', () => keys['ArrowLeft'] = false);

        rightButton.addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys['ArrowRight'] = true;
        });
        rightButton.addEventListener('touchend', () => keys['ArrowRight'] = false);
        rightButton.addEventListener('mousedown', () => keys['ArrowRight'] = true);
        rightButton.addEventListener('mouseup', () => keys['ArrowRight'] = false);

        jumpButton.addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys[' '] = true;
        });
        jumpButton.addEventListener('touchend', () => keys[' '] = false);
        jumpButton.addEventListener('mousedown', () => keys[' '] = true);
        jumpButton.addEventListener('mouseup', () => keys[' '] = false);

        function update() {
            // Gravity
            player.vy += gravity;
            player.y += player.vy;

            // Movement
            if (keys["ArrowLeft"]) player.x -= 5;
            if (keys["ArrowRight"]) player.x += 5;

            player.grounded = false;

            // Collision
            for (let p of platforms) {
                if (player.x < p.x + p.w &&
                    player.x + player.w > p.x &&
                    player.y < p.y + p.h &&
                    player.y + player.h > p.y) {
                    if (player.vy > 0) {
                        player.y = p.y - player.h;
                        player.vy = 0;
                        player.grounded = true;

                        // Win pad
                        if (p.win) {
                            alert("You Win!");
                            location.reload();
                        }
                    }
                }
            }

            // Jump
            if (keys[" "] && player.grounded) {
                player.vy = jumpPower;
                jumpSound.currentTime = 0;
                jumpSound.play();
            }

            // If fall below screen → play video
            if (player.y > canvas.height) {
                let vid = document.getElementById("failVideo");
                vid.style.display = "block";
                vid.play();
                // NEW: Hide the controls
                controls.style.display = "none";
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Player
            ctx.fillStyle = "red";
            ctx.fillRect(player.x, player.y, player.w, player.h);

            // Platforms
            for (let p of platforms) {
                ctx.fillStyle = p.win ? "gold" : "green";
                ctx.fillRect(p.x, p.y, p.w, p.h);
            }
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }
        loop();
    </script>

</body>

</html>
